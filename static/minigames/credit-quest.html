<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Credit Quest â€“ Coinify Arcade</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,700;1,700&family=Plus+Jakarta+Sans:wght@300;400;600;700&family=JetBrains+Mono&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="/static/css/styles.css" />
  <style>.arcade-purple { color: #8332ac; } .arcade-card { border: 2px dashed rgba(131, 50, 172, 0.3); }</style>
</head>
<body>
  <div class="grain-overlay"><svg viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg"><filter id="noiseFilter"><feTurbulence type="fractalNoise" baseFrequency="0.8" numOctaves="4" stitchTiles="stitch"/></filter><rect width="100%" height="100%" filter="url(#noiseFilter)"/></svg></div>

  <main class="page pt-8 pb-12 max-w-lg mx-auto">
    <a href="/static/financial-arcade.html" class="text-xs mono uppercase tracking-widest flex items-center gap-2 mb-6 text-zinc-700">
      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M15 19l-7-7 7-7"/></svg> Arcade
    </a>

    <!-- Title card -->
    <div class="vellum-card p-5 rounded-2xl arcade-card mb-4">
      <div class="flex items-center gap-2"><span class="text-xl">ðŸ“œ</span><h1 class="serif text-2xl italic arcade-purple">Credit Quest</h1></div>
      <p class="text-sm text-gray-600 mt-1">10-month sim: each month pick an action. Build Payment History, keep Utilization low, grow Age. Avoid missed payments!</p>
    </div>

    <!-- Instructions -->
    <div class="vellum-card p-4 rounded-xl arcade-card mb-4">
      <p class="text-xs font-semibold text-zinc-600 uppercase mb-2">How to play</p>
      <p class="text-sm text-gray-600">10 turns (months). Each turn choose one action. Three meters: <strong>Payment History</strong>, <strong>Utilization</strong>, <strong>Age</strong>. Pay full = good; miss payment = bad. Score = final meters minus penalties.</p>
    </div>

    <!-- Game area -->
    <div id="gameArea" class="vellum-card p-5 rounded-2xl arcade-card mb-4">
      <div class="flex justify-between items-center mb-4">
        <span class="mono text-sm font-bold arcade-purple">Month <span id="turn">1</span> / 10</span>
      </div>
      <!-- Progress meters -->
      <div class="space-y-2 mb-6">
        <div>
          <div class="flex justify-between text-xs"><span>Payment History</span><span id="meterPay">50</span></div>
          <div class="h-2 w-full bg-gray-200 rounded-full overflow-hidden"><div id="barPay" class="h-full bg-emerald-500 rounded-full transition-all" style="width: 50%"></div></div>
        </div>
        <div>
          <div class="flex justify-between text-xs"><span>Utilization</span><span id="meterUtil">30</span>%</div>
          <div class="h-2 w-full bg-gray-200 rounded-full overflow-hidden"><div id="barUtil" class="h-full bg-amber-500 rounded-full transition-all" style="width: 30%"></div></div>
        </div>
        <div>
          <div class="flex justify-between text-xs"><span>Age (months)</span><span id="meterAge">1</span></div>
          <div class="h-2 w-full bg-gray-200 rounded-full overflow-hidden"><div id="barAge" class="h-full bg-[#8332ac] rounded-full transition-all" style="width: 10%"></div></div>
        </div>
      </div>
      <p class="text-sm font-semibold text-zinc-700 mb-2">Choose an action this month:</p>
      <div class="grid grid-cols-1 gap-2">
        <button type="button" class="action px-4 py-3 rounded-xl border-2 border-dashed border-gray-300 bg-white/60 text-left font-medium hover:border-[#8332ac]/50 hover:bg-purple-50/50 transition-colors" data-action="payFull">Pay balance in full</button>
        <button type="button" class="action px-4 py-3 rounded-xl border-2 border-dashed border-gray-300 bg-white/60 text-left font-medium hover:border-[#8332ac]/50 hover:bg-purple-50/50 transition-colors" data-action="payMin">Pay minimum only</button>
        <button type="button" class="action px-4 py-3 rounded-xl border-2 border-dashed border-gray-300 bg-white/60 text-left font-medium hover:border-[#8332ac]/50 hover:bg-purple-50/50 transition-colors" data-action="openCard">Open new card (age resets)</button>
        <button type="button" class="action px-4 py-3 rounded-xl border-2 border-dashed border-gray-300 bg-white/60 text-left font-medium hover:border-[#8332ac]/50 hover:bg-purple-50/50 transition-colors" data-action="use10">Keep utilization under 10%</button>
        <button type="button" class="action px-4 py-3 rounded-xl border-2 border-dashed border-gray-300 bg-white/60 text-left font-medium hover:border-[#8332ac]/50 hover:bg-purple-50/50 transition-colors" data-action="miss">Miss a payment</button>
      </div>
    </div>

    <!-- Result -->
    <div id="resultArea" class="vellum-card p-6 rounded-2xl arcade-card hidden text-center">
      <p id="resultText" class="text-lg font-bold mb-4"></p>
      <p class="text-sm text-gray-600 mb-4">You won <span id="resultCoins" class="font-bold arcade-purple">0</span> coins! ðŸª™</p>
      <div class="flex flex-wrap gap-2 justify-center">
        <button type="button" id="saveScoreBtn" class="px-6 py-3 rounded-full font-semibold text-white bg-[#8332ac] hover:opacity-90">Save score</button>
        <button type="button" id="playAgainBtn" class="px-6 py-3 rounded-full font-semibold border-2 border-[#8332ac] arcade-purple hover:bg-purple-50">Play again</button>
      </div>
    </div>
  </main>

  <script src="/static/js/leaderboard.js"></script>
  <script>
(function () {
  var POINTS = 25;
  var TURNS = 10;
  var pay = 50, util = 30, age = 1;
  var missedPayments = 0;
  var turn = 0;

  var EFFECTS = {
    payFull:    { pay: 10, util: -5, age: 0 },
    payMin:    { pay: -5, util: 10, age: 0 },
    openCard:  { pay: 0, util: 0, age: -age },
    use10:     { pay: 5, util: -15, age: 0 },
    miss:      { pay: -20, util: 10, age: 0, missed: true }
  };

  function clamp(v, lo, hi) { return Math.max(lo, Math.min(hi, v)); }

  function updateMeters() {
    pay = clamp(pay, 0, 100);
    util = clamp(util, 0, 100);
    age = clamp(age, 1, 120);
    document.getElementById('meterPay').textContent = pay;
    document.getElementById('meterUtil').textContent = util;
    document.getElementById('meterAge').textContent = age;
    document.getElementById('barPay').style.width = pay + '%';
    document.getElementById('barUtil').style.width = util + '%';
    document.getElementById('barAge').style.width = (age / 120) * 100 + '%';
  }

  function doTurn(action) {
    var e = EFFECTS[action];
    if (!e) return;
    pay += e.pay || 0;
    util += e.util || 0;
    age += e.age || 0;
    if (e.missed) missedPayments++;
    age = Math.max(1, age);
    turn++;
    document.getElementById('turn').textContent = turn + 1;
    updateMeters();
    if (turn >= TURNS) endGame();
  }

  function endGame() {
    document.getElementById('gameArea').classList.add('hidden');
    document.getElementById('resultArea').classList.remove('hidden');
    var score = pay + (100 - util) + Math.min(age, 24);
    score -= missedPayments * 25;
    score = Math.max(0, score);
    var coins = score >= 100 ? POINTS : Math.floor(POINTS * score / 150);
    document.getElementById('resultText').textContent = 'Final: Payment ' + pay + ', Util ' + util + '%, Age ' + age + ' mo. Missed payments: ' + missedPayments + '.';
    document.getElementById('resultText').className = 'text-lg font-bold mb-4 arcade-purple';
    document.getElementById('resultCoins').textContent = coins;
  }

  document.querySelectorAll('.action').forEach(function (btn) {
    btn.addEventListener('click', function () {
      if (turn >= TURNS) return;
      doTurn(this.dataset.action);
    });
  });

  document.getElementById('saveScoreBtn').addEventListener('click', function () {
    var name = getPlayerName() || 'Hero';
    if (!getPlayerName()) setPlayerName(name);
    var coins = parseInt(document.getElementById('resultCoins').textContent, 10);
    addScore(name, coins);
    window.location.href = '/static/financial-arcade.html';
  });

  document.getElementById('playAgainBtn').addEventListener('click', function () {
    pay = 50; util = 30; age = 1; missedPayments = 0; turn = 0;
    document.getElementById('turn').textContent = '1';
    updateMeters();
    document.getElementById('gameArea').classList.remove('hidden');
    document.getElementById('resultArea').classList.add('hidden');
  });

  updateMeters();
})();
  </script>
</body>
</html>
