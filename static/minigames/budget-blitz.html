<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Budget Blitz â€“ Coinify Arcade</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,700;1,700&family=Plus+Jakarta+Sans:wght@300;400;600;700&family=JetBrains+Mono&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="/static/css/styles.css" />
  <style>.arcade-purple { color: #8332ac; } .arcade-card { border: 2px dashed rgba(131, 50, 172, 0.3); } .bucket { min-height: 56px; }</style>
</head>
<body>
  <div class="grain-overlay"><svg viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg"><filter id="noiseFilter"><feTurbulence type="fractalNoise" baseFrequency="0.8" numOctaves="4" stitchTiles="stitch"/></filter><rect width="100%" height="100%" filter="url(#noiseFilter)"/></svg></div>

  <main class="page pt-8 pb-12 max-w-lg mx-auto">
    <a href="/static/financial-arcade.html" class="text-xs mono uppercase tracking-widest flex items-center gap-2 mb-6 text-zinc-700">
      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M15 19l-7-7 7-7"/></svg> Arcade
    </a>

    <!-- Title card -->
    <div class="vellum-card p-5 rounded-2xl arcade-card mb-4">
      <div class="flex items-center gap-2"><span class="text-xl">ðŸ’°</span><h1 class="serif text-2xl italic arcade-purple">Budget Blitz</h1></div>
      <p class="text-sm text-gray-600 mt-1">Resource allocation: fund Needs first, then add a $10 emergency buffer. Stay within budget!</p>
    </div>

    <!-- Instructions -->
    <div class="vellum-card p-4 rounded-xl arcade-card mb-4">
      <p class="text-xs font-semibold text-zinc-600 uppercase mb-2">How to play</p>
      <p class="text-sm text-gray-600">You have <strong>$120</strong>. Tap expense chips to add money to each bucket. Fund <strong>Needs</strong> (Groceries, Gas, Phone) first, then add <strong>$10 to Emergency</strong>. Rent is fixed. Win if all needs + emergency are covered and total â‰¤ $120.</p>
    </div>

    <!-- Game area -->
    <div id="gameArea" class="vellum-card p-5 rounded-2xl arcade-card mb-4">
      <!-- Live remaining balance meter -->
      <div class="flex justify-between items-center mb-4">
        <span class="text-sm font-bold text-zinc-700">Remaining</span>
        <span id="balance" class="mono text-lg font-bold arcade-purple">$120</span>
      </div>
      <div class="h-2 w-full bg-gray-200 rounded-full overflow-hidden mb-6">
        <div id="balanceBar" class="h-full bg-emerald-500 rounded-full transition-all duration-300" style="width: 100%"></div>
      </div>

      <!-- Buckets: Rent, Groceries, Gas, Phone (Needs), Fun, Emergency -->
      <div class="space-y-3">
        <div class="flex items-center justify-between gap-2">
          <span class="text-sm font-medium text-zinc-700 w-24">Rent</span>
          <div class="bucket flex-1 flex flex-wrap gap-1 rounded-lg border-2 border-dashed border-gray-300 bg-white/50 p-2" data-bucket="rent" data-target="40">$<span id="rentVal">0</span></div>
          <span class="text-xs text-gray-500">~$40</span>
        </div>
        <div class="flex items-center justify-between gap-2">
          <span class="text-sm font-medium text-emerald-700 w-24">Groceries</span>
          <div class="bucket flex-1 flex flex-wrap gap-1 rounded-lg border-2 border-dashed border-emerald-300 bg-emerald-50/50 p-2" data-bucket="groceries" data-target="30">$<span id="groceriesVal">0</span></div>
        </div>
        <div class="flex items-center justify-between gap-2">
          <span class="text-sm font-medium text-emerald-700 w-24">Gas</span>
          <div class="bucket flex-1 flex flex-wrap gap-1 rounded-lg border-2 border-dashed border-emerald-300 bg-emerald-50/50 p-2" data-bucket="gas" data-target="25">$<span id="gasVal">0</span></div>
        </div>
        <div class="flex items-center justify-between gap-2">
          <span class="text-sm font-medium text-emerald-700 w-24">Phone</span>
          <div class="bucket flex-1 flex flex-wrap gap-1 rounded-lg border-2 border-dashed border-emerald-300 bg-emerald-50/50 p-2" data-bucket="phone" data-target="15">$<span id="phoneVal">0</span></div>
        </div>
        <div class="flex items-center justify-between gap-2">
          <span class="text-sm font-medium text-zinc-600 w-24">Fun</span>
          <div class="bucket flex-1 flex flex-wrap gap-1 rounded-lg border-2 border-dashed border-gray-300 bg-white/50 p-2" data-bucket="fun" data-target="0">$<span id="funVal">0</span></div>
        </div>
        <div class="flex items-center justify-between gap-2">
          <span class="text-sm font-medium text-amber-700 w-24">Emergency</span>
          <div class="bucket flex-1 flex flex-wrap gap-1 rounded-lg border-2 border-dashed border-amber-300 bg-amber-50/50 p-2" data-bucket="emergency" data-target="10">$<span id="emergencyVal">0</span></div>
        </div>
      </div>

      <!-- Chips: tap to add $5 or $10 to a bucket (tap bucket after selecting?) Simpler: each bucket has +5 +10 buttons -->
      <p class="text-xs text-gray-500 mt-4 mb-2">Add money: tap +5 or +10 below each bucket, or use quick add:</p>
      <div class="flex flex-wrap gap-2">
        <button type="button" class="chip px-3 py-2 rounded-lg border-2 border-dashed border-[#8332ac]/50 bg-purple-50 text-sm font-bold arcade-purple" data-amount="5">+$5</button>
        <button type="button" class="chip px-3 py-2 rounded-lg border-2 border-dashed border-[#8332ac]/50 bg-purple-50 text-sm font-bold arcade-purple" data-amount="10">+$10</button>
      </div>
      <p class="text-xs text-gray-500 mt-2">First tap a bucket above (it will highlight), then tap +5 or +10 to add.</p>
      <button type="button" id="submitBudget" class="w-full mt-4 py-3 rounded-full font-semibold text-white bg-[#8332ac] hover:opacity-90">Check budget</button>
    </div>

    <!-- Result -->
    <div id="resultArea" class="vellum-card p-6 rounded-2xl arcade-card hidden text-center">
      <p id="resultText" class="text-lg font-bold mb-4"></p>
      <p class="text-sm text-gray-600 mb-4">You won <span id="resultCoins" class="font-bold arcade-purple">0</span> coins! ðŸª™</p>
      <div class="flex flex-wrap gap-2 justify-center">
        <button type="button" id="saveScoreBtn" class="px-6 py-3 rounded-full font-semibold text-white bg-[#8332ac] hover:opacity-90">Save score</button>
        <button type="button" id="playAgainBtn" class="px-6 py-3 rounded-full font-semibold border-2 border-[#8332ac] arcade-purple hover:bg-purple-50">Play again</button>
      </div>
    </div>
  </main>

  <script src="/static/js/leaderboard.js"></script>
  <script>
(function () {
  var POINTS = 30;
  var BUDGET = 120;
  var NEEDS = { groceries: 30, gas: 25, phone: 15 };
  var RENT_TARGET = 40;
  var EMERGENCY_TARGET = 10;

  var values = { rent: 0, groceries: 0, gas: 0, phone: 0, fun: 0, emergency: 0 };
  var selectedBucket = null;

  function totalSpent() {
    return values.rent + values.groceries + values.gas + values.phone + values.fun + values.emergency;
  }

  function remaining() { return BUDGET - totalSpent(); }

  function updateUI() {
    document.getElementById('rentVal').textContent = values.rent;
    document.getElementById('groceriesVal').textContent = values.groceries;
    document.getElementById('gasVal').textContent = values.gas;
    document.getElementById('phoneVal').textContent = values.phone;
    document.getElementById('funVal').textContent = values.fun;
    document.getElementById('emergencyVal').textContent = values.emergency;
    var rem = remaining();
    document.getElementById('balance').textContent = '$' + rem;
    document.getElementById('balanceBar').style.width = Math.max(0, (rem / BUDGET) * 100) + '%';
    document.getElementById('balanceBar').className = 'h-full rounded-full transition-all duration-300 ' + (rem < 0 ? 'bg-red-500' : 'bg-emerald-500');
    document.querySelectorAll('.bucket').forEach(function (el) {
      el.classList.toggle('ring-2', el.dataset.bucket === selectedBucket);
      el.classList.toggle('ring-[#8332ac]', el.dataset.bucket === selectedBucket);
    });
  }

  document.querySelectorAll('.bucket').forEach(function (el) {
    el.addEventListener('click', function () {
      selectedBucket = this.dataset.bucket;
      updateUI();
    });
  });

  document.querySelectorAll('.chip').forEach(function (btn) {
    btn.addEventListener('click', function () {
      var amount = parseInt(this.dataset.amount, 10);
      if (!selectedBucket || remaining() < amount) return;
      values[selectedBucket] += amount;
      updateUI();
    });
  });

  document.getElementById('submitBudget').addEventListener('click', function () {
    var spent = totalSpent();
    var needsOk = values.groceries >= NEEDS.groceries && values.gas >= NEEDS.gas && values.phone >= NEEDS.phone;
    var rentOk = values.rent >= RENT_TARGET;
    var emergencyOk = values.emergency >= EMERGENCY_TARGET;
    var underBudget = spent <= BUDGET && spent >= (RENT_TARGET + NEEDS.groceries + NEEDS.gas + NEEDS.phone + EMERGENCY_TARGET);
    var win = needsOk && rentOk && emergencyOk && spent <= BUDGET;

    document.getElementById('gameArea').classList.add('hidden');
    document.getElementById('resultArea').classList.remove('hidden');
    document.getElementById('resultCoins').textContent = win ? POINTS : 0;
    document.getElementById('resultText').textContent = win
      ? 'Budget balanced! Needs + emergency covered.'
      : 'Over budget or needs not covered. Try again!';
    document.getElementById('resultText').className = 'text-lg font-bold mb-4 ' + (win ? 'arcade-purple' : 'text-red-600');
  });

  document.getElementById('saveScoreBtn').addEventListener('click', function () {
    var name = getPlayerName() || 'Hero';
    if (!getPlayerName()) setPlayerName(name);
    var won = document.getElementById('resultText').classList.contains('arcade-purple');
    addScore(name, won ? POINTS : 0);
    window.location.href = '/static/financial-arcade.html';
  });

  document.getElementById('playAgainBtn').addEventListener('click', function () {
    values = { rent: 0, groceries: 0, gas: 0, phone: 0, fun: 0, emergency: 0 };
    selectedBucket = null;
    updateUI();
    document.getElementById('gameArea').classList.remove('hidden');
    document.getElementById('resultArea').classList.add('hidden');
  });
})();
  </script>
</body>
</html>
